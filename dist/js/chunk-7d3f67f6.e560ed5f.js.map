{"version":3,"sources":["webpack:///./src/views/login.vue?a9ee","webpack:///./src/api/user.js","webpack:///./src/views/login.vue?ea46","webpack:///src/views/login.vue","webpack:///./src/views/login.vue?2a23","webpack:///./src/views/login.vue"],"names":["login","data","request","method","url","sendSms","mobile","getCurrentUser","getUserChannels","addFollow","userId","target","deleteFollow","getUserProfile","updataUserProfile","editUserPhoto","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","onLogin","onFailed","formRules","model","value","user","callback","$$v","$set","expression","code","scopedSlots","_u","key","fn","isCountDownShow","isSendSmsLoading","preventDefault","onSendSms","apply","arguments","_v","proxy","staticRenderFns","props","methods","components","component"],"mappings":"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","file":"js/chunk-7d3f67f6.e560ed5f.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&id=b45fc134&scoped=true&lang=less&\"","/* \r\n用户请求模块\r\n*/\r\n\r\nimport request from '../utils/request'\r\n\r\nexport const login = data => {\r\n    return request({\r\n        method: 'POST',\r\n        url: '/app/v1_0/authorizations',\r\n        data\r\n    })\r\n}\r\n\r\n/* \r\n短信验证码\r\n*/\r\nexport const sendSms = mobile => {\r\n    return request({\r\n        method: 'GET',\r\n        url: `/app/v1_0/sms/codes/${mobile}`\r\n    })\r\n}\r\n\r\n/* \r\n获取登录用户自己的信息\r\n */\r\nexport const getCurrentUser = () => {\r\n    return request({\r\n        method: 'GET',\r\n        url: '/app/v1_0/user'\r\n            /* headers: {\r\n                Authorization: `Bearer ${store.state.user.token}`\r\n            } */\r\n    })\r\n}\r\n\r\n/* 获取用户频道列表数据 */\r\nexport const getUserChannels = () => {\r\n    return request({\r\n        method: 'GET',\r\n        url: '/app/v1_0/user/channels'\r\n    })\r\n}\r\n\r\n/* 关注用户 */\r\nexport const addFollow = userId => {\r\n    return request({\r\n        method: 'POST',\r\n        url: '/app/v1_0/user/followings',\r\n        data: {\r\n            target: userId\r\n        }\r\n    })\r\n}\r\n\r\n/* 取消关注用户 */\r\nexport const deleteFollow = userId => {\r\n    return request({\r\n        method: 'DELETE',\r\n        url: `/app/v1_0/user/followings/${userId}`\r\n    })\r\n}\r\n\r\n/* 获取用户个人资料 */\r\nexport const getUserProfile = () => {\r\n    return request({\r\n        method: 'GET',\r\n        url: `/app/v1_0/user/profile`\r\n    })\r\n}\r\n\r\n/* 修改用户个人资料 */\r\nexport const updataUserProfile = data => {\r\n    return request({\r\n        method: 'PATCH',\r\n        url: `/app/v1_0/user/profile`,\r\n        data\r\n    })\r\n}\r\n\r\n/* 编辑用户照片资料（头像、身份证照片） */\r\nexport const editUserPhoto = data => {\r\n    return request({\r\n        method: 'PATCH',\r\n        url: `/app/v1_0/user/photo`,\r\n        data\r\n    })\r\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('van-nav-bar',{staticClass:\"app-nav-bar\",attrs:{\"title\":\"注册/登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"login-form\",attrs:{\"show-error\":false,\"show-error-message\":false,\"validate-first\":true},on:{\"submit\":_vm.onLogin,\"failed\":_vm.onFailed}},[_c('van-field',{attrs:{\"icon-prefix\":\"icon\",\"left-icon\":\"shouji\",\"name\":\"mobile\",\"center\":\"\",\"placeholder\":\"请输入手机号\",\"rules\":_vm.formRules.mobile},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"icon-prefix\":\"icon\",\"left-icon\":\"yanzhengma\",\"clearable\":\"\",\"center\":\"\",\"name\":\"code\",\"placeholder\":\"请输入验证码\",\"rules\":_vm.formRules.code},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [(_vm.isCountDownShow)?_c('van-count-down',{attrs:{\"time\":60 * 1000,\"format\":\"ss s\"},on:{\"finish\":function($event){_vm.isCountDownShow=false}}}):_c('van-button',{staticClass:\"sent-btn\",attrs:{\"size\":\"small\",\"round\":\"\",\"loading\":_vm.isSendSmsLoading},on:{\"click\":function($event){$event.preventDefault();return _vm.onSendSms.apply(null, arguments)}}},[_vm._v(\"发送验证码\")])]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}}),_c('div',{staticClass:\"login-btn-wrap\"},[_c('van-button',{staticClass:\"login-btn\",attrs:{\"type\":\"info\",\"block\":\"\"}},[_vm._v(\"登录\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n<div>\r\n    <van-nav-bar\r\n      class=\"app-nav-bar\"\r\n      title=\"注册/登录\"\r\n      left-arrow\r\n      @click-left=\"$router.back()\"\r\n     />\r\n      <!-- 输入框 -->\r\n      <!-- 2、当1表单提交的时候会触发 submit事件 \r\n            只有表单验证通过，它才会调用 submit\r\n            3、使用 Field的 rules 属性定义校验规则\r\n      -->\r\n    <van-form @submit=\"onLogin\"\r\n    :show-error=\"false\"\r\n    :show-error-message=\"false\"\r\n    @failed=\"onFailed\"\r\n    :validate-first=\"true\"\r\n    ref=\"login-form\">\r\n        <van-field \r\n        v-model=\"user.mobile\" \r\n        icon-prefix=\"icon\"\r\n        left-icon=\"shouji\" \r\n        name=\"mobile\"\r\n        center\r\n        placeholder=\"请输入手机号\"\r\n        :rules=\"formRules.mobile\"/>\r\n        <van-field \r\n        v-model=\"user.code\" \r\n        icon-prefix=\"icon\"\r\n        left-icon=\"yanzhengma\" \r\n        clearable\r\n        center\r\n        name=\"code\"\r\n        placeholder=\"请输入验证码\"\r\n        :rules=\"formRules.code\">\r\n        <template #button>\r\n            <van-count-down \r\n            :time=\"60 * 1000\" \r\n            format=\"ss s\"\r\n            v-if='isCountDownShow'\r\n            @finish=\"isCountDownShow=false\"/>\r\n           <van-button \r\n           size=\"small\" \r\n           v-else\r\n           round class=\"sent-btn\" \r\n           @click.prevent=\"onSendSms\"\r\n           :loading='isSendSmsLoading'>发送验证码</van-button>\r\n        </template>\r\n        </van-field>\r\n        <!-- 登录按钮 -->\r\n        <div class=\"login-btn-wrap\">\r\n         <van-button type=\"info\" block class=\"login-btn\">登录</van-button>\r\n        </div>\r\n    </van-form>\r\n  \r\n</div>\r\n</template>\r\n<script>\r\nimport { login, sendSms} from '../api/user'\r\nimport {Toast} from 'vant'\r\nexport default {\r\n\r\nprops:{\r\n\r\n},\r\ndata(){\r\nreturn {\r\n    user:{\r\n        mobile:'',\r\n        code:''\r\n    },\r\n    formRules:{\r\n        mobile:[\r\n            { required: true, message: '请填写手机号' },\r\n            {pattern:/^(0|86|17951)?(13[0-9]|15[012356789]|166|17[36578]|18[0-9]|14[57])[0-9]{8}$/,message:'手机号格式错误'}\r\n        ],\r\n        code:[\r\n            { required: true, message: '请填写验证码' },\r\n            {pattern:/^\\d{6}$/,message:'验证码格式错误'}\r\n        ]\r\n    },\r\n    isCountDownShow:false,\r\n    // 发送验证码的 loading 状态\r\n    isSendSmsLoading:false,\r\n}\r\n},\r\nmethods:{\r\n   async onLogin(){\r\n        Toast.loading({\r\n          message: '登录中...',\r\n          forbidClick: true,\r\n        })\r\n        // 1、找到数据接口\r\n        // 2、封装请求方法\r\n        // 3、请求调用登录\r\n     try{\r\n        const res = await login(this.user)\r\n        // console.log(res);\r\n        this.$toast.success('登录成功')\r\n        \r\n        this.$store.commit('setUser',res.data.data)\r\n\r\n        // 清除 layout 的缓存,来让它重新渲染\r\n        this.$store.commit('removeCachePage','LatoutIndex')\r\n\r\n        // 登陆成功后，跳转回原来页面\r\n        // this.$router.back()\r\n        this.$router.push(this.$route.query.redirect || '/')\r\n     }catch(err) {\r\n         Toast.fail('登录失败')\r\n         console.log(err);\r\n     }\r\n        // 4、处理响应结果\r\n    },\r\n    // 错误提示\r\n    onFailed(err) {\r\n        console.log(err);\r\n        if(err.errors[0].message) {\r\n            this.$toast({\r\n                message:err.errors[0].message,\r\n                position:'top'\r\n            })\r\n        }\r\n    },\r\n   async onSendSms() {\r\n        // 校验手机号码\r\n      try{\r\n       await this.$refs['login-form'].validate('mobile')\r\n        // console.log(validateRet);\r\n        // 通过后发送验证码\r\n        this.isSendSmsLoading = true  // 防止慢网络用户多次点击\r\n       const res = await sendSms(this.user.mobile)\r\n       console.log(res);\r\n        //    显示倒计时\r\n        // 倒计时结束 显示发送验证码\r\n        this.isCountDownShow = true\r\n        // 隐藏倒计时，显示发送按钮 用failed事件处理\r\n      } catch(err){\r\n        //   console.dir(error)\r\n        let message=''\r\n        if(err && err.response && err.response.status===429) {\r\n            // 发送短信频繁的提示\r\n            message='短信发送频繁，请等会'\r\n        }else if(err.name=\"mobile\") {\r\n            // 表单验证失败的提示\r\n            message=err.message                                    \r\n        }else {\r\n            message='请求失败重新验证'\r\n        }\r\n        this.$toast({\r\n                message, // 提示消息\r\n                position:'top'\r\n            })\r\n      }\r\n    //   无论成功失败 都要关闭发送按钮的 loading 状态\r\n    this.isSendSmsLoading = false\r\n        // 验证通过 -> 请求发送验证码 ->用户接受短信 ->输入验证码->请求登录\r\n        // 请求发送验证码 ->显示倒计时\r\n    }\r\n},\r\ncomponents:{\r\n\r\n},\r\n};\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n    body {\r\n        background-color: #f5f7f9;\r\n    }\r\n        .login-btn-wrap{\r\n            padding: 26px 16px;\r\n            .login-btn{\r\n               background-color: #6db4fb;\r\n               border: none;\r\n               .van-button__text {\r\n                   font-size: 15px;\r\n               }\r\n            }\r\n        }\r\n        .sent-btn {\r\n            width: 76px;\r\n            height: 23px;\r\n            background-color: #ededed;\r\n            .van-button__text{\r\n                font-size: 11px;\r\n                color: #666;\r\n            }\r\n        }\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=b45fc134&scoped=true&\"\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\nimport style0 from \"./login.vue?vue&type=style&index=0&id=b45fc134&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b45fc134\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}